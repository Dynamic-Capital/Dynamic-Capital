[project]
id = "dynamic-capital"
name = "Dynamic Capital"
version = "0.0.0"

[build]
  [[build.buildpacks]]
    uri = "paketo-buildpacks/hugo"

  [[build.buildpacks]]
    uri = "paketo-buildpacks/deno"

  [[build.buildpacks]]
    uri = "paketo-buildpacks/nodejs"

  # Enable build caching for faster subsequent deployments
  [[build.cache]]
    path = "node_modules"

  [[build.cache]]
    path = "apps/web/.next/cache"

  [[build.env]]
    name = "BP_NODE_VERSION"
    value = "20.*"

  [[build.env]]
    name = "BP_NODE_RUN_SCRIPTS"
    value = "build"

  [[build.env]]
    name = "ALLOWED_ORIGINS"
    value = "https://dynamic-capital.ondigitalocean.app,https://dynamic-capital-qazf2.ondigitalocean.app,https://dynamic.capital,https://dynamic-capital.vercel.app,https://dynamic-capital.lovable.app"

  [[build.env]]
    name = "SITE_URL"
    value = "https://dynamic-capital.ondigitalocean.app"

  [[build.env]]
    name = "NEXT_PUBLIC_SITE_URL"
    value = "https://dynamic-capital.ondigitalocean.app"

  [[build.env]]
    name = "MINIAPP_ORIGIN"
    value = "https://dynamic-capital.ondigitalocean.app"

  [[build.env]]
    name = "TELEGRAM_WEBHOOK_URL"
    value = "https://dynamic-capital.ondigitalocean.app/webhook"

  [[build.env]]
    name = "NEXT_TELEMETRY_DISABLED"
    value = "1"

[[processes]]
type = "web"
command = "node apps/web/.next/standalone/apps/web/server.js"
