/* esm.sh - eventsource@2.0.2 */
import __Process$ from "node:process";
import { Buffer as __Buffer$ } from "node:buffer";
import*as __0$ from"node:url";import*as __1$ from"node:events";import*as __2$ from"node:https";import*as __3$ from"node:http";import*as __4$ from"node:util";var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({__esModule:true},m);switch(n){case"node:url":return e(__0$);case"node:events":return e(__1$);case"node:https":return e(__2$);case"node:http":return e(__3$);case"node:util":return e(__4$);default:console.error('module "'+n+'" not found');return null;}};
var D=Object.create;var $=Object.defineProperty;var ee=Object.getOwnPropertyDescriptor;var re=Object.getOwnPropertyNames;var te=Object.getPrototypeOf,ae=Object.prototype.hasOwnProperty;var P=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,r)=>(typeof require<"u"?require:e)[r]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var ne=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var se=(t,e,r,u)=>{if(e&&typeof e=="object"||typeof e=="function")for(let d of re(e))!ae.call(t,d)&&d!==r&&$(t,d,{get:()=>e[d],enumerable:!(u=ee(e,d))||u.enumerable});return t};var oe=(t,e,r)=>(r=t!=null?D(te(t)):{},se(e||!t||!t.__esModule?$(r,"default",{value:t,enumerable:!0}):r,t));var X=ne((ge,W)=>{var J=P("node:url").parse,ie=P("node:events"),fe=P("node:https"),ue=P("node:http"),le=P("node:util"),ve=["pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","secureProtocol","servername","checkServerIdentity"],V=[239,187,191],ce=58,de=32,K=10,pe=13,Q=1024*256,he=/^(cookie|authorization)$/i;function Ee(t){return V.every(function(e,r){return t[r]===e})}function s(t,e){var r=s.CONNECTING,u=e&&e.headers,d=!1;Object.defineProperty(this,"readyState",{get:function(){return r}}),Object.defineProperty(this,"url",{get:function(){return t}});var i=this;i.reconnectInterval=1e3,i.connectionInProgress=!1;function U(n){r!==s.CLOSED&&(r=s.CONNECTING,C("error",new j("error",{message:n})),T&&(t=T,T=null,d=!1),setTimeout(function(){r!==s.CONNECTING||i.connectionInProgress||(i.connectionInProgress=!0,I())},i.reconnectInterval))}var l,N="";u&&u["Last-Event-ID"]&&(N=u["Last-Event-ID"],delete u["Last-Event-ID"]);var B=!1,x="",G="",T=null;function I(){var n=J(t),v=n.protocol==="https:";if(n.headers={"Cache-Control":"no-cache",Accept:"text/event-stream"},N&&(n.headers["Last-Event-ID"]=N),u){var p=d?Ce(u):u;for(var m in p){var w=p[m];w&&(n.headers[m]=w)}}n.rejectUnauthorized=!(e&&!e.rejectUnauthorized),e&&e.createConnection!==void 0&&(n.createConnection=e.createConnection);var _=e&&e.proxy;if(_){var c=J(e.proxy);v=c.protocol==="https:",n.protocol=v?"https:":"http:",n.path=t,n.headers.Host=n.host,n.hostname=c.hostname,n.host=c.host,n.port=c.port}if(e&&e.https){for(var E in e.https)if(ve.indexOf(E)!==-1){var L=e.https[E];L!==void 0&&(n[E]=L)}}e&&e.withCredentials!==void 0&&(n.withCredentials=e.withCredentials),l=(v?fe:ue).request(n,function(a){if(i.connectionInProgress=!1,a.statusCode===500||a.statusCode===502||a.statusCode===503||a.statusCode===504){C("error",new j("error",{status:a.statusCode,message:a.statusMessage})),U();return}if(a.statusCode===301||a.statusCode===302||a.statusCode===307){var y=a.headers.location;if(!y){C("error",new j("error",{status:a.statusCode,message:a.statusMessage}));return}var S=new URL(t).origin,k=new URL(y).origin;d=S!==k,a.statusCode===307&&(T=t),t=y,__Process$.nextTick(I);return}if(a.statusCode!==200)return C("error",new j("error",{status:a.statusCode,message:a.statusMessage})),i.close();r=s.OPEN,a.on("close",function(){a.removeAllListeners("close"),a.removeAllListeners("end"),U()}),a.on("end",function(){a.removeAllListeners("close"),a.removeAllListeners("end"),U()}),C("open",new j("open"));var o,M,F=0,H=-1,A=0,h=0;a.on("data",function(g){o?(g.length>o.length-h&&(A=o.length*2+g.length,A>Q&&(A=o.length+g.length+Q),M=__Buffer$.alloc(A),o.copy(M,0,0,h),o=M),g.copy(o,h),h+=g.length):(o=g,Ee(o)&&(o=o.slice(V.length)),h=o.length);for(var f=0,q=h;f<q;){B&&(o[f]===K&&++f,B=!1);for(var b=-1,R=H,z,O=F;b<0&&O<q;++O)z=o[O],z===ce?R<0&&(R=O-f):z===pe?(B=!0,b=O-f):z===K&&(b=O-f);if(b<0){F=q-f,H=R;break}else F=0,H=-1;Z(o,f,R,b),f+=b+1}f===q?(o=void 0,h=0):f>0&&(o=o.slice(f,h),h=o.length)})}),l.on("error",function(a){i.connectionInProgress=!1,U(a.message)}),l.setNoDelay&&l.setNoDelay(!0),l.end()}I();function C(){i.listeners(arguments[0]).length>0&&i.emit.apply(i,arguments)}this._close=function(){r!==s.CLOSED&&(r=s.CLOSED,l.abort&&l.abort(),l.xhr&&l.xhr.abort&&l.xhr.abort())};function Z(n,v,p,m){if(m===0){if(x.length>0){var w=G||"message";C(w,new me(w,{data:x.slice(0,-1),lastEventId:N,origin:new URL(t).origin})),x=""}G=void 0}else if(p>0){var _=p<0,c=0,E=n.slice(v,v+(_?m:p)).toString();_?c=m:n[v+p+1]!==de?c=p+1:c=p+2,v+=c;var L=m-c,a=n.slice(v,v+L).toString();if(E==="data")x+=a+`
`;else if(E==="event")G=a;else if(E==="id")N=a;else if(E==="retry"){var y=parseInt(a,10);Number.isNaN(y)||(i.reconnectInterval=y)}}}}W.exports=s;le.inherits(s,ie.EventEmitter);s.prototype.constructor=s;["open","error","message"].forEach(function(t){Object.defineProperty(s.prototype,"on"+t,{get:function(){var r=this.listeners(t)[0];return r?r._listener?r._listener:r:void 0},set:function(r){this.removeAllListeners(t),this.addEventListener(t,r)}})});Object.defineProperty(s,"CONNECTING",{enumerable:!0,value:0});Object.defineProperty(s,"OPEN",{enumerable:!0,value:1});Object.defineProperty(s,"CLOSED",{enumerable:!0,value:2});s.prototype.CONNECTING=0;s.prototype.OPEN=1;s.prototype.CLOSED=2;s.prototype.close=function(){this._close()};s.prototype.addEventListener=function(e,r){typeof r=="function"&&(r._listener=r,this.on(e,r))};s.prototype.dispatchEvent=function(e){if(!e.type)throw new Error("UNSPECIFIED_EVENT_TYPE_ERR");this.emit(e.type,e.detail)};s.prototype.removeEventListener=function(e,r){typeof r=="function"&&(r._listener=void 0,this.removeListener(e,r))};function j(t,e){if(Object.defineProperty(this,"type",{writable:!1,value:t,enumerable:!0}),e)for(var r in e)e.hasOwnProperty(r)&&Object.defineProperty(this,r,{writable:!1,value:e[r],enumerable:!0})}function me(t,e){Object.defineProperty(this,"type",{writable:!1,value:t,enumerable:!0});for(var r in e)e.hasOwnProperty(r)&&Object.defineProperty(this,r,{writable:!1,value:e[r],enumerable:!0})}function Ce(t){var e={};for(var r in t)he.test(r)||(e[r]=t[r]);return e}});var Y=oe(X()),be=Y.default??Y;export{be as default};
//# sourceMappingURL=eventsource.mjs.map