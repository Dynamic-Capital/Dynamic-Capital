/* esm.sh - standardwebhooks@1.0.0 */
import*as __0$ from"/@stablelib/base64@^1.0.0?target=denonext";import*as __1$ from"/fast-sha256@^1.3.0?target=denonext";var require=n=>{const e=m=>typeof m.default<"u"?m.default:m,c=m=>Object.assign({__esModule:true},m);switch(n){case"@stablelib/base64":return c(__0$);case"fast-sha256":return e(__1$);default:console.error('module "'+n+'" not found');return null;}};
var D=Object.create;var p=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var T=Object.getPrototypeOf,_=Object.prototype.hasOwnProperty;var l=(t=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(t,{get:(e,o)=>(typeof require<"u"?require:e)[o]}):t)(function(t){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var y=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var j=(t,e,o,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of N(e))!_.call(t,i)&&i!==o&&p(t,i,{get:()=>e[i],enumerable:!(r=M(e,i))||r.enumerable});return t};var W=(t,e,o)=>(o=t!=null?D(T(t)):{},j(e||!t||!t.__esModule?p(o,"default",{value:t,enumerable:!0}):o,t));var S=y(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.timingSafeEqual=void 0;function E(t,e=""){if(!t)throw new Error(e)}function A(t,e){if(t.byteLength!==e.byteLength)return!1;t instanceof DataView||(t=new DataView(ArrayBuffer.isView(t)?t.buffer:t)),e instanceof DataView||(e=new DataView(ArrayBuffer.isView(e)?e.buffer:e)),E(t instanceof DataView),E(e instanceof DataView);let o=t.byteLength,r=0,i=-1;for(;++i<o;)r|=t.getUint8(i)^e.getUint8(i);return r===0}u.timingSafeEqual=A});var v=y(s=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});s.Webhook=s.WebhookVerificationError=void 0;var B=S(),b=l("@stablelib/base64"),L=l("fast-sha256"),k=5*60,w=class t extends Error{constructor(e){super(e),Object.setPrototypeOf(this,t.prototype),this.name="ExtendableError",this.stack=new Error(e).stack}},n=class t extends w{constructor(e){super(e),Object.setPrototypeOf(this,t.prototype),this.name="WebhookVerificationError"}};s.WebhookVerificationError=n;var h=class t{constructor(e,o){if(!e)throw new Error("Secret can't be empty.");if(o?.format==="raw")e instanceof Uint8Array?this.key=e:this.key=Uint8Array.from(e,r=>r.charCodeAt(0));else{if(typeof e!="string")throw new Error("Expected secret to be of type string");e.startsWith(t.prefix)&&(e=e.substring(t.prefix.length)),this.key=b.decode(e)}}verify(e,o){let r={};for(let f of Object.keys(o))r[f.toLowerCase()]=o[f];let i=r["webhook-id"],a=r["webhook-signature"],c=r["webhook-timestamp"];if(!a||!i||!c)throw new n("Missing required headers");let m=this.verifyTimestamp(c),x=this.sign(i,m,e).split(",")[1],O=a.split(" "),d=new globalThis.TextEncoder;for(let f of O){let[V,q]=f.split(",");if(V==="v1"&&(0,B.timingSafeEqual)(d.encode(q),d.encode(x)))return JSON.parse(e.toString())}throw new n("No matching signature found")}sign(e,o,r){if(typeof r!="string")if(r.constructor.name==="Buffer")r=r.toString();else throw new Error("Expected payload to be of type string or Buffer.");let i=new TextEncoder,a=Math.floor(o.getTime()/1e3),c=i.encode(`${e}.${a}.${r}`);return`v1,${b.encode(L.hmac(this.key,c))}`}verifyTimestamp(e){let o=Math.floor(Date.now()/1e3),r=parseInt(e,10);if(isNaN(r))throw new n("Invalid Signature Headers");if(o-r>k)throw new n("Message timestamp too old");if(r>o+k)throw new n("Message timestamp too new");return new Date(r*1e3)}};s.Webhook=h;h.prefix="whsec_"});var g=W(v()),{__esModule:$,Webhook:H,WebhookVerificationError:J}=g,K=g.default??g;export{H as Webhook,J as WebhookVerificationError,$ as __esModule,K as default};
//# sourceMappingURL=standardwebhooks.mjs.map