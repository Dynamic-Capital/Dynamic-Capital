/* esm.sh - @supabase/storage-js@2.10.4 */
import { Buffer as __Buffer$ } from "node:buffer";
var m=class extends Error{constructor(r){super(r),this.__isStorageError=!0,this.name="StorageError"}};function l(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}var x=class extends m{constructor(r,t,e){super(r),this.name="StorageApiError",this.status=t,this.statusCode=e}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},v=class extends m{constructor(r,t){super(r),this.name="StorageUnknownError",this.originalError=t}};var D=function(i,r,t,e){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function u(c){try{d(e.next(c))}catch(h){a(h)}}function s(c){try{d(e.throw(c))}catch(h){a(h)}}function d(c){c.done?o(c.value):n(c.value).then(u,s)}d((e=e.apply(i,r||[])).next())})},S=i=>{let r;return i?r=i:typeof fetch>"u"?r=(...t)=>import("/@supabase/node-fetch@^2.6.14?target=denonext").then(({default:e})=>e(...t)):r=fetch,(...t)=>r(...t)},k=()=>D(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield import("/@supabase/node-fetch@^2.6.14?target=denonext")).Response:Response}),O=i=>{if(Array.isArray(i))return i.map(t=>O(t));if(typeof i=="function"||i!==Object(i))return i;let r={};return Object.entries(i).forEach(([t,e])=>{let n=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));r[n]=O(e)}),r},P=i=>{if(typeof i!="object"||i===null)return!1;let r=Object.getPrototypeOf(i);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)};var y=function(i,r,t,e){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function u(c){try{d(e.next(c))}catch(h){a(h)}}function s(c){try{d(e.throw(c))}catch(h){a(h)}}function d(c){c.done?o(c.value):n(c.value).then(u,s)}d((e=e.apply(i,r||[])).next())})},U=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),L=(i,r,t)=>y(void 0,void 0,void 0,function*(){let e=yield k();i instanceof e&&!t?.noResolveJson?i.json().then(n=>{let o=i.status||500,a=n?.statusCode||o+"";r(new x(U(n),o,a))}).catch(n=>{r(new v(U(n),n))}):r(new v(U(i),i))}),A=(i,r,t,e)=>{let n={method:i,headers:r?.headers||{}};return i==="GET"||!e?n:(P(e)?(n.headers=Object.assign({"Content-Type":"application/json"},r?.headers),n.body=JSON.stringify(e)):n.body=e,Object.assign(Object.assign({},n),t))};function w(i,r,t,e,n,o){return y(this,void 0,void 0,function*(){return new Promise((a,u)=>{i(t,A(r,e,n,o)).then(s=>{if(!s.ok)throw s;return e?.noResolveJson?s:s.json()}).then(s=>a(s)).catch(s=>L(s,u,e))})})}function g(i,r,t,e){return y(this,void 0,void 0,function*(){return w(i,"GET",r,t,e)})}function p(i,r,t,e,n){return y(this,void 0,void 0,function*(){return w(i,"POST",r,e,n,t)})}function _(i,r,t,e,n){return y(this,void 0,void 0,function*(){return w(i,"PUT",r,e,n,t)})}function F(i,r,t,e){return y(this,void 0,void 0,function*(){return w(i,"HEAD",r,Object.assign(Object.assign({},t),{noResolveJson:!0}),e)})}function E(i,r,t,e,n){return y(this,void 0,void 0,function*(){return w(i,"DELETE",r,e,n,t)})}var f=function(i,r,t,e){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function u(c){try{d(e.next(c))}catch(h){a(h)}}function s(c){try{d(e.throw(c))}catch(h){a(h)}}function d(c){c.done?o(c.value):n(c.value).then(u,s)}d((e=e.apply(i,r||[])).next())})},B={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},R={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1},$=class{constructor(r,t={},e,n){this.url=r,this.headers=t,this.bucketId=e,this.fetch=S(n)}uploadOrUpdate(r,t,e,n){return f(this,void 0,void 0,function*(){try{let o,a=Object.assign(Object.assign({},R),n),u=Object.assign(Object.assign({},this.headers),r==="POST"&&{"x-upsert":String(a.upsert)}),s=a.metadata;typeof Blob<"u"&&e instanceof Blob?(o=new FormData,o.append("cacheControl",a.cacheControl),s&&o.append("metadata",this.encodeMetadata(s)),o.append("",e)):typeof FormData<"u"&&e instanceof FormData?(o=e,o.append("cacheControl",a.cacheControl),s&&o.append("metadata",this.encodeMetadata(s))):(o=e,u["cache-control"]=`max-age=${a.cacheControl}`,u["content-type"]=a.contentType,s&&(u["x-metadata"]=this.toBase64(this.encodeMetadata(s)))),n?.headers&&(u=Object.assign(Object.assign({},u),n.headers));let d=this._removeEmptyFolders(t),c=this._getFinalPath(d),h=yield(r=="PUT"?_:p)(this.fetch,`${this.url}/object/${c}`,o,Object.assign({headers:u},a?.duplex?{duplex:a.duplex}:{}));return{data:{path:d,id:h.Id,fullPath:h.Key},error:null}}catch(o){if(l(o))return{data:null,error:o};throw o}})}upload(r,t,e){return f(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",r,t,e)})}uploadToSignedUrl(r,t,e,n){return f(this,void 0,void 0,function*(){let o=this._removeEmptyFolders(r),a=this._getFinalPath(o),u=new URL(this.url+`/object/upload/sign/${a}`);u.searchParams.set("token",t);try{let s,d=Object.assign({upsert:R.upsert},n),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(d.upsert)});typeof Blob<"u"&&e instanceof Blob?(s=new FormData,s.append("cacheControl",d.cacheControl),s.append("",e)):typeof FormData<"u"&&e instanceof FormData?(s=e,s.append("cacheControl",d.cacheControl)):(s=e,c["cache-control"]=`max-age=${d.cacheControl}`,c["content-type"]=d.contentType);let h=yield _(this.fetch,u.toString(),s,{headers:c});return{data:{path:o,fullPath:h.Key},error:null}}catch(s){if(l(s))return{data:null,error:s};throw s}})}createSignedUploadUrl(r,t){return f(this,void 0,void 0,function*(){try{let e=this._getFinalPath(r),n=Object.assign({},this.headers);t?.upsert&&(n["x-upsert"]="true");let o=yield p(this.fetch,`${this.url}/object/upload/sign/${e}`,{},{headers:n}),a=new URL(this.url+o.url),u=a.searchParams.get("token");if(!u)throw new m("No token returned by API");return{data:{signedUrl:a.toString(),path:r,token:u},error:null}}catch(e){if(l(e))return{data:null,error:e};throw e}})}update(r,t,e){return f(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",r,t,e)})}move(r,t,e){return f(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:r,destinationKey:t,destinationBucket:e?.destinationBucket},{headers:this.headers}),error:null}}catch(n){if(l(n))return{data:null,error:n};throw n}})}copy(r,t,e){return f(this,void 0,void 0,function*(){try{return{data:{path:(yield p(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:r,destinationKey:t,destinationBucket:e?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(n){if(l(n))return{data:null,error:n};throw n}})}createSignedUrl(r,t,e){return f(this,void 0,void 0,function*(){try{let n=this._getFinalPath(r),o=yield p(this.fetch,`${this.url}/object/sign/${n}`,Object.assign({expiresIn:t},e?.transform?{transform:e.transform}:{}),{headers:this.headers}),a=e?.download?`&download=${e.download===!0?"":e.download}`:"";return o={signedUrl:encodeURI(`${this.url}${o.signedURL}${a}`)},{data:o,error:null}}catch(n){if(l(n))return{data:null,error:n};throw n}})}createSignedUrls(r,t,e){return f(this,void 0,void 0,function*(){try{let n=yield p(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:r},{headers:this.headers}),o=e?.download?`&download=${e.download===!0?"":e.download}`:"";return{data:n.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${o}`):null})),error:null}}catch(n){if(l(n))return{data:null,error:n};throw n}})}download(r,t){return f(this,void 0,void 0,function*(){let n=typeof t?.transform<"u"?"render/image/authenticated":"object",o=this.transformOptsToQueryString(t?.transform||{}),a=o?`?${o}`:"";try{let u=this._getFinalPath(r);return{data:yield(yield g(this.fetch,`${this.url}/${n}/${u}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(u){if(l(u))return{data:null,error:u};throw u}})}info(r){return f(this,void 0,void 0,function*(){let t=this._getFinalPath(r);try{let e=yield g(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:O(e),error:null}}catch(e){if(l(e))return{data:null,error:e};throw e}})}exists(r){return f(this,void 0,void 0,function*(){let t=this._getFinalPath(r);try{return yield F(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(l(e)&&e instanceof v){let n=e.originalError;if([400,404].includes(n?.status))return{data:!1,error:e}}throw e}})}getPublicUrl(r,t){let e=this._getFinalPath(r),n=[],o=t?.download?`download=${t.download===!0?"":t.download}`:"";o!==""&&n.push(o);let u=typeof t?.transform<"u"?"render/image":"object",s=this.transformOptsToQueryString(t?.transform||{});s!==""&&n.push(s);let d=n.join("&");return d!==""&&(d=`?${d}`),{data:{publicUrl:encodeURI(`${this.url}/${u}/public/${e}${d}`)}}}remove(r){return f(this,void 0,void 0,function*(){try{return{data:yield E(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:r},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}list(r,t,e){return f(this,void 0,void 0,function*(){try{let n=Object.assign(Object.assign(Object.assign({},B),t),{prefix:r||""});return{data:yield p(this.fetch,`${this.url}/object/list/${this.bucketId}`,n,{headers:this.headers},e),error:null}}catch(n){if(l(n))return{data:null,error:n};throw n}})}encodeMetadata(r){return JSON.stringify(r)}toBase64(r){return typeof __Buffer$<"u"?__Buffer$.from(r).toString("base64"):btoa(r)}_getFinalPath(r){return`${this.bucketId}/${r.replace(/^\/+/,"")}`}_removeEmptyFolders(r){return r.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(r){let t=[];return r.width&&t.push(`width=${r.width}`),r.height&&t.push(`height=${r.height}`),r.resize&&t.push(`resize=${r.resize}`),r.format&&t.push(`format=${r.format}`),r.quality&&t.push(`quality=${r.quality}`),t.join("&")}};var C="2.10.4";var I={"X-Client-Info":`storage-js/${C}`};var b=function(i,r,t,e){function n(o){return o instanceof t?o:new t(function(a){a(o)})}return new(t||(t=Promise))(function(o,a){function u(c){try{d(e.next(c))}catch(h){a(h)}}function s(c){try{d(e.throw(c))}catch(h){a(h)}}function d(c){c.done?o(c.value):n(c.value).then(u,s)}d((e=e.apply(i,r||[])).next())})},j=class{constructor(r,t={},e,n){let o=new URL(r);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(o.hostname)&&!o.hostname.includes("storage.supabase.")&&(o.hostname=o.hostname.replace("supabase.","storage.supabase.")),this.url=o.href,this.headers=Object.assign(Object.assign({},I),t),this.fetch=S(e)}listBuckets(){return b(this,void 0,void 0,function*(){try{return{data:yield g(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(r){if(l(r))return{data:null,error:r};throw r}})}getBucket(r){return b(this,void 0,void 0,function*(){try{return{data:yield g(this.fetch,`${this.url}/bucket/${r}`,{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}createBucket(r,t={public:!1}){return b(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/bucket`,{id:r,name:r,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(l(e))return{data:null,error:e};throw e}})}updateBucket(r,t){return b(this,void 0,void 0,function*(){try{return{data:yield _(this.fetch,`${this.url}/bucket/${r}`,{id:r,name:r,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(l(e))return{data:null,error:e};throw e}})}emptyBucket(r){return b(this,void 0,void 0,function*(){try{return{data:yield p(this.fetch,`${this.url}/bucket/${r}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}deleteBucket(r){return b(this,void 0,void 0,function*(){try{return{data:yield E(this.fetch,`${this.url}/bucket/${r}`,{},{headers:this.headers}),error:null}}catch(t){if(l(t))return{data:null,error:t};throw t}})}};var T=class extends j{constructor(r,t={},e,n){super(r,t,e,n)}from(r){return new $(this.url,this.headers,r,this.fetch)}};export{x as StorageApiError,T as StorageClient,m as StorageError,v as StorageUnknownError,l as isStorageError};
//# sourceMappingURL=storage-js.mjs.map